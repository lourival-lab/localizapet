<script>
  async function carregarPets() {
    try {
      const { data, error } = await supabaseClient
        .from("pets")
        .select("*")
        .order("id", { ascending: true });

      if (error) {
        console.error("Erro ao carregar pets:", error);
        document.body.innerHTML += "<p style='color:red'>Erro ao carregar pets.</p>";
        return;
      }
      if (!data || data.length === 0) {
        console.log("Nenhum pet cadastrado.");
        document.body.innerHTML += "<p>Nenhum pet cadastrado.</p>";
        return;
      }

      const bounds = [];

      data.forEach(pet => {
        const lat = parseFloat(pet.latitude);
        const lng = parseFloat(pet.longitude);
        if (!isNaN(lat) && !isNaN(lng)) {
          bounds.push([lat, lng]);

          // üëâ √çcone com miniatura + borda colorida
          const borderColor = pet.status === "encontrado" ? "green" : "red";
          const iconHtml = `
            <div style="width:50px;height:50px;border-radius:50%;overflow:hidden;
                        border:3px solid ${borderColor};box-shadow:0 0 5px rgba(0,0,0,0.5);">
              <img src="${pet.foto}" alt="${pet.nome}" 
                   style="width:100%;height:100%;object-fit:cover;">
            </div>
          `;

          const icon = L.divIcon({
            html: iconHtml,
            className: "custom-pet-icon",
            iconSize: [50, 50],
            iconAnchor: [25, 25],
            popupAnchor: [0, -25]
          });

          const marker = L.marker([lat, lng], { icon }).addTo(map);

          const popupContent = `
            <h3>${pet.nome}</h3>
            <img src="${pet.foto}" alt="Foto de ${pet.nome}"
                 style="width:150px;height:150px;object-fit:cover;border-radius:8px;margin:5px 0;">
            <p><b>Status:</b> ${pet.status}</p>
            <p><b>Contato:</b> ${pet.contato || "N√£o informado"}</p>
            <a href="detalhe.html?id=${pet.id}" class="btn-detalhe">üîç Ver detalhes</a>
          `;

          marker.bindPopup(popupContent);
        }
      });

      if (bounds.length > 0) {
        map.fitBounds(bounds);
      }
    } catch (e) {
      console.error("Erro inesperado:", e);
      document.body.innerHTML += "<p style='color:red'>Erro inesperado: " + e.message + "</p>";
    }
  }

  carregarPets();
</script>
