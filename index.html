<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸ¾ Mapa de Pets</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #E8F5E9;
      margin: 0;
      padding: 0;
    }
    header {
      background: #C8E6C9;
      color: #2E7D32;
      padding: 15px;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
    }
    nav {
      text-align: center;
      padding: 10px;
      background: #2E7D32;
    }
    nav a {
      color: white;
      margin: 0 10px;
      text-decoration: none;
      font-weight: bold;
    }
    #map {
      height: 80vh;
      width: 100%;
    }
    .pet-icon {
      border-radius: 50%;
      border: 2px solid #2E7D32;
    }
  </style>
</head>
<body>
  <header>ğŸ¾ Mapa de Pets Perdidos</header>
  <nav>
    <a href="index.html">InÃ­cio</a>
    <a href="lista.html">Lista</a>
    <a href="mapa.html">Mapa</a>
  </nav>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const supabaseClient = supabase.createClient(
      "https://ijzkiooyisfdmbmdjmso.supabase.co",
      "sb_publishable_OTMLQWCUsgMZSuRALOk--g_EVe657MT"
    );

    const map = L.map('map').setView([-27.0, -49.3], 10); // ajuste para sua regiÃ£o
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap'
    }).addTo(map);

    async function carregarPets() {
      const { data: pets, error } = await supabaseClient
        .from("pets")
        .select("*");

      if (error) {
        console.error(error);
        return;
      }

      pets.forEach(pet => {
        if (pet.latitude && pet.longitude) {
          // Criar Ã­cone com miniatura
          const petIcon = L.icon({
            iconUrl: pet.foto || 'img/pet-placeholder.png',
            iconSize: [50, 50],
            className: 'pet-icon'
          });

          const marker = L.marker([pet.latitude, pet.longitude], { icon: petIcon }).addTo(map);

          marker.bindPopup(`
            <b>${pet.nome}</b><br>
            ${pet.tipo || "NÃ£o informado"}<br>
            Status: ${pet.status}<br>
            <img src="${pet.foto || 'img/pet-placeholder.png'}" width="100">
            <a href="detalhe.html?id=${pet.id}">ğŸ” Ver detalhes</a>
          `);
        }
      });
    }

    carregarPets();
  </script>
</body>
</html>



